{% extends "main.html" %}
{% load static %}

{% block content %}

<article>
    <div class="container-fluid">
        <div class="d-flex align-items-start gap-2 my-2">
            <a href="{% url 'Dashboard:admin-dashboard' %}" class="text-decoration-none"><h5 class="m-0 light-gray fw-medium">Home</h5></a>
            <span class="material-symbols-rounded light-gray">
                keyboard_arrow_right
                </span>
            <h5 class="m-0 light-gray fw-medium">Leave Application</h5>
            <span class="material-symbols-rounded light-gray">
                keyboard_arrow_right
                </span>
            <h5 class="m-0 light-gray fw-medium">Balances</h5>
        </div>

    </div>

    <div class="article-container">
        <div class="mt-1">
            <div class="pt-2">
                <h1 class="display-6 fw-bold dark-gray mb-3">Leave Balances</h1>
            </div>

            <div class="table-controls-admin">
                <div class="d-flex gap-1">
                    <div class="InputContainer">
                        <input type="text" name="text" class="searchinput" id="searchInput" placeholder="Search" onkeyup="searchPRFTable()">
                        <label for="searchInput" class="labelforsearch">
                        <svg viewBox="0 0 512 512" class="searchIcon"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
                        </label>
                    </div>
                </div>

                <form method="POST" action="{% url 'upload-balances' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="file" id="fileInput" name="file" accept=".xlsx, .xls" style="display: none;">
                    <button class="btn border-0 p-0" type="submit" id="uploadBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32" fill="#343b48">
                            <path d="M480-337q-8 0-15-2.5t-13-8.5L308-492q-12-12-11.5-28t11.5-28q12-12 28.5-12.5T365-549l75 75v-286q0-17 11.5-28.5T480-800q17 0 28.5 11.5T520-760v286l75-75q12-12 28.5-11.5T652-548q11 12 11.5 28T652-492L508-348q-6 6-13 8.5t-15 2.5ZM240-160q-33 0-56.5-23.5T160-240v-80q0-17 11.5-28.5T200-360q17 0 28.5 11.5T240-320v80h480v-80q0-17 11.5-28.5T760-360q17 0 28.5 11.5T800-320v80q0 33-23.5 56.5T720-160H240Z"/>
                        </svg>
                    </button>
                </form>
            </div>

            {% if balances %}
            <!-- Table -->
            <div class="table-container">
                <table id="requestTable">
                <thead>
                    <th class="light-gray" onclick="sortAccountTable(0)">ID Number</th>
                    <th class="light-gray" onclick="sortAccountTable(1)">Name</th>
                    <th class="light-gray" onclick="sortAccountTable(2)">Type</th>
                    <th class="light-gray" onclick="sortAccountTable(3)">Date Started</th>
                    <th class="light-gray">Date Ended</th>
                    <th class="light-gray" onclick="sortAccountTable(5)">Balance</th>
                </thead>
                <tbody class="admin-account-approval-table">
                    {% for balance in balances %}
                    <tr>
                        <td>{{balance.name.idnumber}}</td>
                        <td>{{balance.name.name}}</td>
                        <td>{{balance.leave_type}} {{balance.date_started|date:'Y'}}</td>
                        <td>{{balance.date_started|date:'F d, Y'}}</td>
                        <td>{{balance.date_ended|date:'F d, Y'}}</td>
                        <td>{{balance.balances}}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                </table>
            </div>
            {% else %}
                <div class="no-filed-prf-container">      
                    <div><h5 class="light-gray">Looks like you currently dont have uploaded leave balances yet.</h5></div>
                    <img src="{% static 'images/empty-box.png' %}" alt="no data found">
                </div>
            {% endif %}
        </div>
    </div>           
</article>

<script>
    function sortAccountTable(columnIndex) {
        const table = document.getElementById("requestTable");
        const rows = Array.from(table.rows).slice(1);
        const sortedRows = rows.sort((a, b) => {
          const aText = a.cells[columnIndex].innerText.toLowerCase();
          const bText = b.cells[columnIndex].innerText.toLowerCase();
          return aText.localeCompare(bText);
        });
      
        sortedRows.forEach(row => table.tBodies[0].appendChild(row));
      }

    function searchPRFTable() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("requestTable");
        const rows = table.getElementsByTagName("tr");
      
        for (let i = 1; i < rows.length; i++) {
          const cells = rows[i].getElementsByTagName("td");
          let shouldDisplay = false;
          for (let j = 0; j < cells.length - 1; j++) {
            if (cells[j].innerText.toLowerCase().includes(filter)) {
              shouldDisplay = true;
              break;
            }
          }
          rows[i].style.display = shouldDisplay ? "" : "none";
        }
      }
      
    document.getElementById('uploadBtn').addEventListener('click', function(event) {
        event.preventDefault();
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function() {
        if (this.files.length > 0) {
            document.querySelector('form').submit();
        }
    });
</script>

{% endblock content %}