{% extends "main.html" %}
{% load static %}


{% block content %}

<article>
    <div class="container-fluid">
        <div class="d-flex align-items-start gap-2 my-2">
            <a href="{% url 'Dashboard:admin-dashboard' %}" class="text-decoration-none">
                <h5 class="m-0 light-gray fw-medium">Home</h5>
            </a>
            <span class="material-symbols-rounded light-gray">
                keyboard_arrow_right
            </span>
            <h5 class="m-0 light-gray fw-medium">Assessments</h5>
            <span class="material-symbols-rounded light-gray">
                keyboard_arrow_right
            </span>
            <a href="{% url 'admin-performance' %}" class="text-decoration-none">
                <h5 class="m-0 light-gray fw-medium">Performance Evaluation</h5>
            </a>
            <span class="material-symbols-rounded light-gray">
                keyboard_arrow_right
            </span>
            <h5 class="m-0 light-gray fw-medium">{{quarter.quarter}}</h5>
        </div>

    </div>

    <div class="article-container">
        <div class="mt-1">
            <div class="survey-header">
                <div>
                    <h1 class="display-6 fw-bold dark-gray">Performance Evaluation</h1>
                </div>
                
                <div class="d-flex justify-content-end gap-1 align-items-end">
                    {% if quarter.state == "OPEN" %}
                        <form method="POST" action="{% url 'close-performance' pk=quarter.id %}">
                            {% csrf_token %}
                            <button class="button-light" type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                </svg>
                                Close Evaluation
                            </button>
                        </form>
                    {% endif %}

                    <a href="{% url 'export-performance-evaluation' pk=quarter.id %}" class="text-decoration-none">
                        <button class="button-light">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
                                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
                              </svg>
                            Export
                        </button>
                    </a>
                </div>
            </div>

            <div class="row px-2">
                <!-- total employees -->
                <div class="col-12 col-md-3 p-1">
                    <div class="card survey-card-container">
                        <div class="card-body d-flex flex-column justify-content-betweengap-3">
                            <h5 class="dark-gray fw-medium">Employees</h5>
                            <div>
                                <div class="d-flex gap-2 align-items-end pt-2">
                                    <img src="{% static 'images/icons/employees.png' %}" class="survey-img"
                                        alt="employees count">
                                    <h2 class="fw-bold light-gray lh-1 m-0">{{employee_counts}}</h2>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <!-- total respondent -->
                <div class="col-12 col-md-3 p-1">
                    <div class="card survey-card-container">
                        <div class="card-body d-flex flex-column justify-content-betweengap-3">
                            <h5 class="dark-gray fw-medium">Respondent</h5>
                            <div>
                                <div class="d-flex gap-2 align-items-end pt-2">
                                    <img src="{% static 'images/icons/respond.png' %}" class="survey-img"
                                        alt="respondent" class="survey-img" class="survey-img">
                                    <h2 class="fw-bold light-gray lh-1 m-0">{{submits}}</h2>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <!-- total percentage -->
                <div class="col-12 col-md-3 p-1">
                    <div class="card survey-card-container">
                        <div class="card-body d-flex flex-column justify-content-betweengap-3">
                            <h5 class="dark-gray fw-medium">Response Rate</h5>
                            <div>
                                <div class="d-flex gap-2 align-items-end pt-2">
                                    <img src="{% static 'images/icons/graph.png' %}" class="survey-img"
                                        alt="response rate">
                                    <h2 class="fw-bold light-gray lh-1 m-0">{{response_percentage}}%</h2>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
                <!-- total average -->
                <div class="col-12 col-md-3 p-1">
                    <div class="card survey-card-container">
                        <div class="card-body d-flex flex-column justify-content-betweengap-3">
                            <h5 class="dark-gray fw-medium">Overall Average</h5>
                            <div>
                                <div class="d-flex gap-2 align-items-end pt-2">
                                    <img src="{% static 'images/icons/graph.png' %}" class="survey-img"
                                        alt="survey average">
                                    <h2 class="fw-bold light-gray lh-1 m-0">--%</h2>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>

            <div class="table-container">
                {% if employee_responses %}
                <table id="requestTable">
                    <thead>
                        <tr>
                            <th class="light-gray">Date Submitted</th>
                            <th class="light-gray">ID Number</th>
                            <th class="light-gray">Name</th>
                            <th class="light-gray">Department</th>
                            <th class="light-gray">Line</th>
                            <th class="light-gray">Status</th>
                            <th class="light-gray">Action</th>
                        </tr>
                    </thead>
                    <tbody class="accordion-table-container">
                        {% for response in employee_responses %}
                            <tr>
                                <td>{% if response.date_submitted %}{{response.date_submitted|date:'F d, Y'}}{% else %}<span class="text-danger">Not yet submitted</span>{% endif %}</td>
                                <td>{{response.employee.idnumber}}</td>
                                <td>{{response.employee.name}}</td>
                                <td>{{response.employee.employment_info.first.department}}</td>
                                <td>{{response.employee.employment_info.first.line.line}}</td>
                                <td>
                                    {% if response.is_evaluated %}
                                    <span class="status-badge status-answer">Evaluated</span>
                                    {% else %}
                                    <span class="status-badge status-noanswer">For Evaluation</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if response.date_submitted %}
                                        <a href="{% url 'view-employee-response' pk=response.id %}" class="text-decoration-none">
                                            <button type="button" class="button-light">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="#E85C0D" class="bi bi-folder2-open action-icon" viewBox="0 0 16 16" stroke="#E85C0D" stroke-width="0.5">
                                                    <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7z"/>
                                                </svg>
                                            </button>
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="no-filed-prf-container">
                    <div><h5 class="light-gray">No employees for evaluation.</h5></div>
                    <img src="{% static 'images/empty-box.png' %}" alt="no data found">
                </div>
                {% endif %}
            </div>

        </div>

    </div>

</article>

{% endblock content %}